<!DOCTYPE html>
<!-- saved from url=(0043)http://10.3.3.3:88/statics/miao-player.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <title>å¤§å–µæ’­æ”¾å™¨</title>
  <style>
    body,html {
      margin: 0;
      height: 100%;
    }
    video {
      max-width: 100%;
      max-height: 100%;
      display: block;
      margin: auto;
    }
    main {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
    }
    .video-wrap {
      flex-grow: 1;
      height: calc(100% - 32px);
      display: flex;
      align-items: center;
    }
    .player {
      display: flex;
      height: 100%;
    }
    .playlist-wrap {
      width: 200px;
      height: 100%;
      flex: none;
      display: flex;
      border-right: 1px solid;
      flex-direction: column;
    }
    h5 {
      margin: 0;
    }
    button label {
      display: flex;
      height: 100%;
      align-items: center;
      margin: -2px -7px;
      padding: 2px 7px;
    }
    /* .btn {
      padding: 3px 5px;
      border-radius: .3em;
      background-color: #1e1e1e;
      color: white;
      border: 1px solid;
      box-sizing: border-box;
      margin: 0;
      font-size: 16px;
      cursor: pointer;
    } */
    /* .btn:hover {
      background-color: #272727;
    }
    .btn:active {
      background-color: #181818;
    } */
    .playlist {
      padding: 0;
      margin: 0;
      list-style: none;
      overflow-x: hidden;
      overflow-y: auto;
      flex-grow: 1;
    }
    .playlist li {
      white-space: nowrap;
      font-size: 12px;
      text-overflow: ellipsis;
      overflow: hidden;
      cursor: default;
      user-select: none;
    }
    .playlist li:hover {
      background-color: pink;
    }
    .playlist li.active {
      background-color: pink;
    }

    .menu {
      font-size: 14px;
      margin-top: 5px;
      display: flex;
      align-items: center;
    }
    .menu * {
      font-size: inherit;
    }
    .menu input[type="range"] {
      width: 60px;
      cursor: pointer;
    }
    body {
      -webkit-app-region: drag;
      user-select: none;
    }
  </style>
</head>
<body>
  <div class="player">
    <div class="playlist-wrap" style="display: none;">
      <h5>æ’­æ”¾åˆ—è¡¨
        <!-- (å¯ç›´æ¥æ‹–å…¥è§†é¢‘) -->
      </h5>
      <ul class="playlist"></ul>
    </div>
    <main>
      <div class="video-wrap">
        <pre id="help">          æ¬¢è¿ä½¿ç”¨å¤§å–µæ’­æ”¾å™¨ï¼Œæ–¹ä¾¿çš„å€é€Ÿæ’­æ”¾å™¨
            åœ¨æŸæ¡£ä½æ—¶
              æŒ‰ä½jæˆ–fæˆ–ç”¨é¼ æ ‡ç‚¹ä½è§†é¢‘å¯æš‚æ—¶æ€§è¿›å…¥ä¸‹ä¸€æ¡£ä½
              ç±»ä¼¼äºæ°®æ°”ğŸ˜æ¾å¼€åå›åˆ°åŸæ¡£ä½
            å€é€Ÿé€Ÿç‡å¯è°ƒ
            ä¸­é”®ç‚¹å‡»è§†é¢‘å¯åˆ‡æ¢å…¨å±
            å¯é€‰æ’­æ”¾åˆ—è¡¨
            åŒå‡»è§†é¢‘åˆ‡æ¢æ’­æ”¾çŠ¶æ€
        </pre>
        <video src="" controls=""></video>
      </div>
      <div class="menu">
        <button class="playlist-btn">æ’­æ”¾åˆ—è¡¨</button>
        <button><label for="video-select">é€‰æ‹©æ–‡ä»¶</label></button>
        <input type="file" id="video-select" hidden="" multiple="" accept="video/*, .mkv">
        <button class="go-fullscreen">å…¨å±</button>
        <button onclick="setOriginalPlay()">ä¸€æ¡£</button>
        <button onclick="setNormalPlay()">äºŒæ¡£</button>
        <button onclick="setFastPlay()">ä¸‰æ¡£</button>
        <span>[[å½“å‰é€Ÿç‡:<span style="color:red;font-weight:bold;" id="currentSpeedShow">1.5</span>]]</span>
        <span title="æŒ‰ä½jæˆ–fæˆ–ç”¨é¼ æ ‡æŒ‰ä½è§†é¢‘å³å¯å€é€Ÿæ’­æ”¾">äºŒæ¡£é€Ÿç‡</span>(<span id="currentNormalSpeedShow">1.5</span>)<input type="range" id="currentNormalSpeedControl" min="1" max="4" step="0.1" value="1.5">
        <span title="æŒ‰ä½jæˆ–fæˆ–ç”¨é¼ æ ‡æŒ‰ä½è§†é¢‘å³å¯å€é€Ÿæ’­æ”¾">ä¸‰æ¡£é€Ÿç‡</span>(<span id="currentFastSpeedShow">2.3</span>)<input type="range" id="currentFastSpeedControl" min="1" max="4" step="0.1" value="2">
        <span style="margin-left: auto; display: none;" class="filename"></span>
      </div>
    </main>
  </div>
  <script>
    var fileSelect = document.querySelector('[type="file"]')
    var video = document.querySelector('video')
    var filename = document.querySelector('.filename')
    var togglePlaylistBtn = document.querySelector('.playlist-btn')
    var playlistWrap = document.querySelector('.playlist-wrap')
    var fullscreenBtn = document.querySelector('.go-fullscreen')
    var playlist = document.querySelector('.playlist')
    var currentNormalSpeedControl = document.querySelector('#currentNormalSpeedControl')
    var currentFastSpeedControl = document.querySelector('#currentFastSpeedControl')
    var currentSpeedShow = document.querySelector('#currentSpeedShow')

    var playlistSelected = false // æ˜¯å¦å·²é€‰æ‹©è§†é¢‘æ–‡ä»¶ï¼Œå¦‚æœé€‰æ‹©ï¼Œå…³é—­/åˆ·æ–°ç½‘é¡µæ—¶ä¼šæœ‰æç¤º



    // æ ¹æ®ä¿å­˜çš„çŠ¶æ€éšè—æ’­æ”¾åˆ—è¡¨
    if (localStorage.showPlaylist == 'false') {
      playlistWrap.style.display = 'none'
    }


    // å¦‚æœå·²ç»é€‰æ‹©æ–‡ä»¶ï¼Œå…³é—­æ—¶ä¼šæç¤ºï¼Œçœå¾—ä¸€ä¸å°å¿ƒåˆ·æ–°åéœ€è¦é‡æ–°é€‰æ‹©æ–‡ä»¶
    window.onbeforeunload = function() {
      if (playlistSelected) {
        return 'å·²é€‰æ‹©æ’­æ”¾åˆ—è¡¨ï¼Œåˆ·æ–°å°†éœ€è¦é‡æ–°é€‰æ‹©è¦æ’­æ”¾çš„æ–‡ä»¶'
      }
    }

    fileSelect.onchange = function(e) {
      help.remove()
      playlistSelected = true
      var files = Array.from(fileSelect.files).sort().reverse()
      video.src = URL.createObjectURL(files[0])
      video.play()
      buttonUp()
      document.title = files[0].name
      showPlaylist(fileSelect.files)
      playlist.firstElementChild.classList.add('active')
    }

    function showPlaylist(files) {
      // showPlaylistPane()
      files = Array.from(files)
      files.sort().reverse()
      for (var file of files) {
        var li = document.createElement('li')
        li.title = li.textContent = file.name
        li.file = file
        playlist.append(li)
      }
    }

    function togglePlaylistPane() {
      if (playlistWrap.style.display == 'none') {
        playlistWrap.style.display = 'flex'
        localStorage.showPlaylist = 'true'
      } else {
        playlistWrap.style.display = 'none'
        localStorage.showPlaylist = 'false'
      }
    }
    function showPlaylistPane() {
      playlistWrap.style.display = 'flex'
    }

    playlist.addEventListener('dblclick', function(e) {
      if (e.target.matches('li')) {
        URL.revokeObjectURL(video.src)
        var file = e.target.file
        video.src = URL.createObjectURL(file)
        video.play()
        buttonUp()
        document.title = file.name
        document.querySelector('ul.playlist .active').classList.remove('active')
        e.target.classList.add('active')
      }
    })

    fullscreenBtn.onclick = function() {
      video.requestFullscreen()
    }
    togglePlaylistBtn.onclick = function() {
      togglePlaylistPane()
    }


    // ä¸æŒ‰å„ç§é”®æ—¶çš„é€Ÿåº¦æ¨¡å¼
    var speedMode = localStorage.playState ?? 'ORIGINAL' // 'NORMAL' | 'FAST'
    // var tempSpeedMode = null // æŒ‰ä¸‹é”®ä»¥åçš„æ’­æ”¾çŠ¶æ€

    currentNormalSpeedControl.value = parseFloat(localStorage.currentNormalSpeed) || 1.5
    currentFastSpeedControl.value = parseFloat(localStorage.currentFastSpeed) || 1.5
    currentNormalSpeedShow.textContent = Number(currentNormalSpeedControl.value).toFixed(1)
    currentFastSpeedShow.textContent = Number(currentFastSpeedControl.value).toFixed(1)

    currentNormalSpeedControl.oninput = function(e) {
      var speed = Number(e.target.value).toFixed(1)
      currentNormalSpeedShow.textContent = speed
      localStorage.currentNormalSpeed = speed
      if (speedMode == 'NORMAL') {
        normalPlay()
      }
    }
    currentFastSpeedControl.oninput = function(e) {
      var speed = Number(e.target.value).toFixed(1)
      currentFastSpeedShow.textContent = speed
      localStorage.currentFastSpeed = speed
      if (speedMode == 'FAST') {
        fastPlay()
      }
    }

    function originalPlay() {
      currentSpeedShow.textContent = video.playbackRate = '1.0'
    }
    function normalPlay() {
      currentSpeedShow.textContent = video.playbackRate = Number(currentNormalSpeedControl.value).toFixed(1)
    }
    function fastPlay() {
      currentSpeedShow.textContent = video.playbackRate = Number(currentFastSpeedControl.value).toFixed(1)
    }

    function setOriginalPlay() {
      localStorage.playState = speedMode = 'ORIGINAL'
      originalPlay()
    }
    function setNormalPlay() {
      localStorage.playState = speedMode = 'NORMAL'
      normalPlay()
    }
    function setFastPlay() {
      localStorage.playState = speedMode = 'FAST'
      fastPlay()
    }

    buttonUp() // åˆå§‹çŠ¶æ€ç”±speedModeå†³å®šï¼Œè€ŒspeedModeä»localStorageé‡Œè¯»å‡ºæ¥

    function buttonDown() {
      if (speedMode == 'ORIGINAL') {
        normalPlay()
      } else if (speedMode == 'NORMAL') {
        fastPlay()
      }
    }
    function buttonUp() {
      if (speedMode == 'NORMAL') {
        normalPlay()
      } else if (speedMode == 'FAST') {
        fastPlay()
      } else if (speedMode == 'ORIGINAL') {
        originalPlay()
      }
    }

    document.addEventListener('keydown', function(e) {
      if (e.key == 'j' || e.key == 'f') {
        buttonDown()
      }
      // if (e.key == 'ArrowLeft' || e.key == 'a') {
      //   e.preventDefault()
      //   video.currentTime -= 2
      // }
      // if (e.key == 'ArrowRight' || e.key == 'd') {
      //   e.preventDefault()
      //   video.currentTime += 2
      // }
      if (e.key == 'ArrowLeft') {
        e.preventDefault()
        video.currentTime -= 1
      }
      if (e.key == 'ArrowRight') {
        e.preventDefault()
        video.currentTime += 1
      }
      if (e.keyCode == 188) {
        e.preventDefault()
        video.currentTime -= 3
      }
      if (e.keyCode == 190) {
        e.preventDefault()
        video.currentTime += 3
      }
    })
    document.addEventListener('keyup', function(e) {
      if (e.key == 'j' || e.key == 'f') {
        buttonUp()
      }
    })

    // è§†é¢‘åŒå‡»æš‚åœ
    video.addEventListener('dblclick', function(e) {
      console.log('dblclick')
      if (video.paused) {
        video.play()
      } else {
        video.pause()
      }
    })

    // // é˜»æ­¢ç‚¹å‡»è§†é¢‘æš‚åœ
    // video.addEventListener('click', function(e) {
    //   e.preventDefault()
    // })

    var isInFullscreen = false
    video.addEventListener('mousedown', function(e) {
      if (e.which == 1) { // å·¦é”®ï¼Œå¿«æ”¾
        buttonDown()
      } else if (e.which == 2) { // ä¸­é”®ï¼Œåˆ‡æ¢å…¨å±çŠ¶æ€ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªå˜é‡è®°å½•å…¨å±çŠ¶æ€
        e.preventDefault()
        if (!isInFullscreen) {
          video.requestFullscreen()
        } else {
          document.exitFullscreen()
        }
        isInFullscreen = !isInFullscreen
      }
    })
    video.addEventListener('mouseup', function(e) {
      if (e.which == 1) {
        buttonUp()
      }
    })

    // å¤„äºå¼¹çª—çŠ¶æ€æ—¶å¯æ‹–åŠ¨çª—å£
    window.addEventListener('mousedown', function(e) {
      if (e.which == 1 && e.target.matches(':not(input):not(button,button *)')) {
        var x = e.screenX
        var y = e.screenY

        var left = window.screenLeft
        var top = window.screenTop

        function move(e) {
          if (e.which == 0){
            window.removeEventListener('mousemove', move)
          }
          var dx = e.screenX - x
          var dy = e.screenY - y
          if (dx * dx + dy * dy > 10) { // ç§»åŠ¨è·ç¦»å¤§äºä¸€å®šé‡åå°±ä¸åŠ é€Ÿ
            buttonUp()
          }
          window.moveTo(left + dx, top + dy)
        }
        window.addEventListener('mousemove', move)
      }
    })
  </script>


</body><style id="stylus-1" type="text/css" class="stylus">main {
    height: 100%;
}

#live iframe{
  border: 1px solid #cccccc;
  padding-top: 0;
  margin-top: 35px;
  height: calc(100% - 36px);
}

.panel .label{
  min-width: 295px;
}



@media only screen and (max-width: 735px) {
  .menu.inline-menu{
    zoom: 0.5;
    width: initial;
  }
  #live iframe{
    margin-top: 0px;
    height: 100%;
  }
  #bin {
    top: 21px;
  }
  #control #panels > a.button {
    height: 21px;
    line-height: 17px;
  }
  #control{
    height: 20px;
  }
}

@media only screen and (max-width: 735px){
  #source{
    bottom: 0;
  }
}</style></html>
